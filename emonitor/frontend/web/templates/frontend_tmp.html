<!doctype html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta http-equiv="expires" content="43200"/>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="Access-Control-Allow-Origin" content="*" />
        <!--
            This website is powered by eMonitor
        -->
        <title>{{ _('frontend.titlemain') }}</title>
        <meta name="generator" content="eMonitor"/>
        <link href="/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/css/font-awesome.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="/css/main.css" />
        <link rel="stylesheet" href="/css/layout.css" />
        <script type="text/javascript" language="javascript" src="/js/jquery-1.11.0.min.js"> </script>
        <script type="text/javascript" language="javascript" src="/js/jquery-ui-1.10.1.min.js"> </script>
        <script type="text/javascript" language="javascript" src="/js/jquery.layout.min.js"> </script>
        <script type="text/javascript" language="javascript" src="/js/bootstrap.min.js"></script>
        <script type="text/javascript" language="javascript" src="/streets/inc/leaflet.js"> </script>
    </head>

    <body>
        <script>
            var layout;

            $(document).ready(function () {
                layout = $('#maincontainer').layout({
                    north: {closable:false, resizable:false, spacing_open: 0, spacing_closed: 0, size:40},
                    south: {closable:false, resizable:false, spacing_open: 0, spacing_closed: 0, size:20},
                    west: {size:.3, onresize: function(){map.invalidateSize(true);}, maskContents: true,},
                    east: {size:.2, onresize: function(){map.invalidateSize(true);}},
                    center: {showOverflowOnHover:true,},
                    resizerTip:'{{ _('layout.resize') }}',
                    togglerTip_open: '{{ _('layout.open') }}',
                    togglerTip_closed: '{{ _('layout.closed') }}'
                });
            });
        </script>
        <style>
            div.user ul { margin:0px; padding: 0; list-style: none; cursor: pointer; position: relative; text-align:right;}
            div.user ul li { padding: 0.25em 3px 0.3em 15px;}
            div.user ul ul { z-index: 200000; display: none; position: absolute; right: 0px; bottom: 0; margin: 0; margin-bottom: 1.55em;text-align:right;border:1px solid black;}
            div.user .dropdown ul ul { bottom: auto; margin: 0; margin-top: 1.45em;}
            div.user ul ul li { padding: 0.3em 5px 0.3em 5px;}
            div.user ul ul li:hover { background-color:rgb(171,171,171);}
            div.user ul li:hover ul { display: block; background-color:rgb(222,222,222);z-index: 200000;}

            .leaflet-control-layers-group-name {font-weight: bold; margin-bottom: .2em; display: block; }
            .leaflet-control-layers-group {margin-bottom: .5em;}
            .leaflet-control-layers-group label {padding-left:.5em;}
         </style>

        <div class="maincontainer" id="maincontainer">
            <div class="pane ui-layout-center" style="padding:0px !important;margin:0px !important;">
                {{ current_mod.getFrontendContent()|safe }}
            </div>
            <div class="pane ui-layout-north">
                <h1 style="padding-left:10px;">{{_('frontend.titlemain') }}</h1>
                <div class="header_links"><a href="/admin">{{ _('frontend.adminlink') }}</a></div>
                <div class="user" style="text-align:right;z-index:30;overflow:visible;">
                    {% if user %}
                    <div class="dropdown">
                        <ul>
                            <li>
                                <ul>
                                    <li><a href="/user">{{ user.username }}</a></li>
                                    <li><a href="/logout">logout</a></li>
                                </ul>
                                <img src="/img/user.png" title="{{ user.username }}"/>
                            </li>
                        </ul>
                    </div>
                    {% else %}
                    <div style="margin-top:3px;">
                        <a href="/login" title="{{ _('frontend.login') }}">
                            <img src="/img/nouser.png"/>
                        </a>
                    </div>
                    {% endif %}
                </div>
                <!--<div class="navigation">
                    <div style="float:left;">
                        {% for module in modules %}
                        <a href="/{{ modules[module].info['path'] }}" {% if module==current_mod.info['name'] %} class="current" {% endif %}>{{ _('module.frontend.'+module) }}</a>
                        {% endfor %}
                    </div>
                </div>-->
                <div style="position:absolute;top:10px;left:10px;right:10px;text-align:center;">
                    {% if get_flashed_messages()|count>0 %}
                    <p class="error">
                        {% for msg in get_flashed_messages() %}
                            {{ _(msg) }}<br/>
                        {% endfor %}
                    </p>
                    {% endif %}
                </div>
            </div>
            <iframe class="pane ui-layout-west" style="padding:0px !important;margin:0px !important;overflow:hidden;width:100%;height:100%;" src="/alarms">
            </iframe>
            <div class="pane ui-layout-east" style="padding:0px !important;margin:0px !important;">
                {{ current_mod.getFrontendContent({'area':'east'})|safe }}
            </div>
            <div class="pane ui-layout-south">
                <div style="clear:both;position:fixed;bottom:5px;left:30px;">
                    <small style="color:rgb(171,171,171)">{{ app_name }} <span>{{ app_version }}</span></small>
                </div>
                <div class="footer_functions">
                    <a href="#" onclick="showMonitorDefinition()" title="{{ _('frontend.show.monitors') }}"><i class="fa fa-desktop fa-lg"></i></a>
                    &nbsp;&nbsp;&nbsp;
                    <a href="#" onclick="poll(true);return false;"><i class="fa fa-times"></i></a>
                </div>
            </div>
            <div class="version"> </div>

            <link rel="stylesheet" href="/streets/inc/leaflet.css" />
            <link rel="stylesheet" href="/streets/inc/streets.css" />
            <style>
                .leaflet-right.leaflet-bottom{display:none}
                .footer_functions{position:absolute;right:10px;top:2px;color:#fff;}
                .footer_functions a{color:#fff;}
                .footer_functions a:hover{color:#428bca;}
            </style>
        </div>
        <script>
            function closeOverlay(){
                $('.overlay').toggle();return false;
            }

            function showMonitorDefinition(){
                $.ajax({ type : "POST", url : "/data/monitors?action=monitoroverview",
                    success: function(result) {
                        $('#overlaycontent').html(result);
                        $('.overlay').toggle();return false;
                    }
                });
            }
            polling = 0;
            function poll(click) {
                if (click){
                    if(polling==0){
                        polling = 1;
                        console.log('activate polling');
                    }else{
                        polling = 0;
                        console.log('de-activate polling');
                    }
                }
                $.ajax({type: "GET", url: "/data/poll",
                    contentType: 'application/json;charset=UTF-8',
                    success: function(data) {
                          console.log("polling result:", data);
                    },
                    complete: function(){
                        if(polling==1){
                            setTimeout(function() {poll()}, 5000);
                        }
                    },
                    timeout: 5000
                })
            };
        </script>
        <div class="overlay">
            <div class="overlay_back"> </div>
            <div class="popup" id="popup">
                <div class="popup_close"><a href="#" onclick="return closeOverlay()"><img src="/img/close.png"/></a></div>
                <div id="overlaycontent"> </div>
            </div>
        </div>
    </body>
</html>
