<div style="padding:0 5px;">

    <div style="height:250px">
        <h4>{{ _('alarms.messagetitles') }}</h4>

        <div style="height:220px;border:1px solid silver;display:block;overflow:auto;">
        {% for message in alarm.history|sort(reverse=True, attribute='timestamp') %}
            <div>{{ message.timestamp|datetime }}: {{ message.name }} <em>{{ message.value }}</em></div>
        {% endfor %}
        </div>
    </div>
    <div style="height:150;clear:left;">
        <form id="addmessage">
            <h4>{{ _('alarms.addmessage') }}</h4>
            <div style="width:235px;float:left;padding:0!important;margin:0!important;position:relative;">
                {{ _('alarms.messagetype') }}:<br/>
                <select name="messagestate" style="width:200px;">
                    <option>--</option>
                    {% for messagestate in messagestates %}
                    <option value="{{ messagestate }}">{{ _('history.'+messagestate) }}</option>
                    {% endfor %}
                </select>
                <br/>
                <br/>
                <!--<button name="action"><i class="fa fa-check"></i> {{ _('alarms.save') }}</button>-->
                <button name="button" onclick="return addMessage()"><i class="fa fa-check"></i> {{ _('alarms.save') }}</button>
            </div>
            <div style="width:350px;float:left;padding:0!important;margin:0!important;position:relative;">

                {{ _('alarms.messagetext') }}:<br/>
                <textarea name="messagetext" style="width:100%;height:60px;"></textarea>
            </div>
            <input type="hidden" name="alarmid" value="{{ alarm.id }}"/>
        </form>
    </div>

    <script>
        function addMessage(){
            $.ajax({
                url: '/data/alarms?action=addmessage&area={{ area }}',
                type: 'post',
                data: $('form#addmessage').serialize(),
                success: function(result) {
                    $('iframe#alarms').attr('src', '/alarms?area={{ area }}');
                    parent.$('#overlaycontent').html(result);
                }
            });
            return false;
        }
    </script>
</div>
